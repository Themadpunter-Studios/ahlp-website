<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>AHLP Levels</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-950 text-white min-h-screen flex flex-col">
    <div class="container mx-auto p-4">
      <h1 class="text-3xl font-bold mb-4">Appel Hardest Level Progression</h1>
      <p>
        The Appel Hardest Level Progression is a website intended to show you good levels to play for your current skill level to help you progress and gain skills.
        It includes a tracker that helps you track which levels you've completed, different tiers and skill levels, and more.
      </p>
      <br>
      <!-- Tabs -->
      <div id="tabs" class="flex space-x-2 mb-2"></div>
      <!-- Current Badge -->
      <div id="badge-display" class="mb-4"></div>
      <!-- Table -->
      <div id="table-container" class="min-h-[400px]">
        <table class="w-full border-collapse table-fixed">
          <colgroup>
            <col class="w-1/12">
            <!-- checkbox -->
            <col class="w-1/4">
            <!-- 25% -->
            <col class="w-1/5">
            <!-- 20% -->
            <col class="w-1/5">
            <!-- 20% -->
            <col class="w-1/5">
            <!-- 20% -->
            <col class="w-1/10">
            <!-- 10% -->
          </colgroup>
          <thead>
            <tr class="bg-gray-800">
              <th class="p-2 text-left">‚úî</th>
              <th class="p-2 text-left">Level Name</th>
              <th class="p-2 text-left">Creator</th>
              <th class="p-2 text-left">Skill 1</th>
              <th class="p-2 text-left">Skill 2</th>
              <th class="p-2 text-left">Level Code</th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>
    </div>
    <script>
      // === CONFIG ===
      const SHEET_ID = "16ABG_twIFkV59ysUpBR0gChxomBg0iU30N8VXWKgXJs";
      const GID = "0";
      const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}`;
      let levels = [];
      let ranks = [];
      let currentRank = null;
      // Order + colors
      const RANK_ORDER = ["Beginner", "Bronze", "Silver", "Gold", "Platinum", "Emerald", "Diamond", "Onyx", "Amethyst"];
      const RANK_COLORS = {
        Beginner: "bg-blue-500 text-black",
        Bronze: "bg-amber-700",
        Silver: "bg-gray-400 text-black",
        Gold: "bg-yellow-400 text-black",
        Platinum: "bg-gray-100 text-black",
        Emerald: "bg-green-500",
        Diamond: "bg-cyan-400 text-black",
        Onyx: "bg-gray-700",
        Amethyst: "bg-purple-500"
      };
      async function fetchSheet() {
        const res = await fetch(SHEET_URL);
        const text = await res.text();
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;
        levels = rows.map(r => {
          const c = r.c.map(x => x ? x.v : "");
          return {
            id: c[0],
            name: c[1],
            creator: c[2],
            skill1: c[3],
            skill2: c[4],
            rank: c[5],
            code: c[6]
          };
        });
        ranks = RANK_ORDER.filter(rank => levels.some(l => l.rank === rank));
        currentRank = ranks[0];
        renderTabs();
        renderTable(currentRank);
      }

      function renderTabs() {
        const tabDiv = document.getElementById("tabs");
        tabDiv.innerHTML = "";
        ranks.forEach(rank => {
          const btn = document.createElement("button");
          btn.textContent = rank;
          // Always use the rank color
          btn.className = "px-4 py-2 rounded-lg transition-colors " + (RANK_COLORS[rank] || "bg-gray-600");
          // Add a darker hover variant for feedback
          btn.className += " hover:opacity-80";
          btn.onclick = () => {
            currentRank = rank;
            renderTabs();
            renderTable(rank);
          };
          tabDiv.appendChild(btn);
        });
      }

      function renderTable(rank) {
        const tbody = document.getElementById("table-body");
        const filtered = levels.filter(l => l.rank === rank);
        tbody.innerHTML = filtered.map(l => {
          const checked = localStorage.getItem("ahlp_" + l.id) === "true";
          return `
          
										<tr class="border-b border-gray-700 hover:bg-gray-800">
											<td class="p-2">
												<input type="checkbox" ${checked ? "checked" : ""} 
                     onchange="toggleLevel('${l.id}', this.checked)">
												</td>
												<td class="p-2 truncate">${l.name}</td>
												<td class="p-2 truncate">${l.creator}</td>
												<td class="p-2 truncate">${l.skill1}</td>
												<td class="p-2 truncate">${l.skill2}</td>
												<td class="p-2">
													<button onclick="copyCode('${l.code}')" 
                      class="bg-blue-600 hover:bg-blue-500 px-2 py-1 rounded">
                Copy
              </button>
												</td>
											</tr>
        `;
        }).join("");
        updateBadgeDisplay(rank);
      }

      function toggleLevel(id, checked) {
        localStorage.setItem("ahlp_" + id, checked);
        renderTabs();
        updateBadgeDisplay(currentRank);
      }

      function copyCode(code) {
        navigator.clipboard.writeText(code);
        alert("Copied: " + code);
      }

      function updateBadgeDisplay(rank) {
        const badgeDiv = document.getElementById("badge-display");
        const rankLevels = levels.filter(l => l.rank === rank);
        const completed = rankLevels.filter(l => localStorage.getItem("ahlp_" + l.id) === "true").length;
        const half = Math.ceil(rankLevels.length / 2);
        badgeDiv.innerHTML = "";
        // Half badge
        if (completed >= half && rankLevels.length > 0) {
          const halfBadge = document.createElement("div");
          halfBadge.textContent = rank + " Badge üèÖ";
          halfBadge.className = "inline-block px-3 py-1 rounded-lg mr-2 " + (RANK_COLORS[rank] || "bg-green-600");
          badgeDiv.appendChild(halfBadge);
        }
        // Full badge
        if (completed === rankLevels.length && rankLevels.length > 0) {
          const fullBadge = document.createElement("div");
          fullBadge.textContent = rank + " Mastery Badge üèÜ";
          fullBadge.className = "inline-block px-3 py-1 rounded-lg " + (RANK_COLORS[rank] || "bg-green-600");
          badgeDiv.appendChild(fullBadge);
        }
        // Always show progress underneath
        const progress = document.createElement("div");
        progress.textContent = `${completed} / ${rankLevels.length} levels completed`;
        progress.className = "mt-2 text-gray-300";
        badgeDiv.appendChild(progress);
      }
      fetchSheet();
    </script>
  </body>
</html>